<!DOCTYPE html>
<!--[if IE 7 ]>    <html dir="ltr" lang="en-US" class="no-js ie7 oldie"> <![endif]-->
<!--[if IE 8 ]>    <html dir="ltr" lang="en-US" class="no-js ie8 oldie"> <![endif]-->
<!--[if IE 9 ]>    <html dir="ltr" lang="en-US" class="no-js ie9 oldie"> <![endif]-->
<!--[if (gt IE 9)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html id="html" dir="ltr" lang="en-US" class="no-js"><!-- InstanceBegin template="/Templates/content-promo.dwt" codeOutsideHTMLIsLocked="false" --><!--<![endif]-->
<head>
<!-- InstanceBeginEditable name="doctitle" -->
	<title>MOD Sandbox - About OpenTripPlanner</title>
	<!-- InstanceEndEditable -->
<!--#include virtual="/asset/includes/head.htm" -->
<!--#include virtual="/global/includes/head.htm" -->
<!-- InstanceBeginEditable name="head" -->

	<link rel="stylesheet" href="css/styles.css">

	<link href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" rel="stylesheet" />
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
	<script src="https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.js"></script>
	<link href="https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.css" rel="stylesheet" />
	<script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js"></script>
	<link title="timeline-styles" rel="stylesheet" href="https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css">
	<script src="https://cdn.knightlab.com/libs/timeline3/latest/js/timeline.js"></script>
	<script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js"></script>

	<!-- <link rel="stylesheet" href="https://trimet.org/asset/css/style.min.css" />
    <link rel="stylesheet" href="https://trimet.org/global/css/styles.min.css" type="text/css" media="all" /> -->
	<!-- InstanceEndEditable -->
</head>

<body class="env-develop" id="top">
<div id="application">
<!--#include virtual="/asset/includes/nav.htm" -->
<section id="content" class="content">
<!-- InstanceBeginEditable name="Main" -->

	<div class="standardheader wide">
		<p class="breadcrumb"><a href="/index.htm">Home</a> : <a href="/mod/index.htm">MOD Sandbox</a> : About OTP</p>
		<h1>About OpenTripPlanner</h1>

		<div class="first">
			<p>OpenTripPlanner (OTP) is an Open Source, Multi-Modal Trip Planning System collaboratively developed by a team of developers from across the world and coordinated by OpenPlans and TriMet. The OTP Project was initially funded through the Metro 2009&ndash;2011 Regional Travel Options Grant.</p>
		</div>
	</div>

	<!------- INTRO BEGIN ------->
    <div class="fullwidth">
        <div class="contentcontainer">
            <div class="row">
                <div class="col-xs-12 col-lg-10 col-lg-offset-1">


                    <ul class="anchor">
                        <li><a href="#overview">Overview</a></li>
                        <li><a href="#history">TriMet Trip Planner History</a></li>
                        <li><a href="#deploy">OTP Deployments</a></li>
                    </ul>

					<p id="overview">TriMet&rsquo;s older text-based trip planner was a proprietary transit trip planner, providing transit trip itineraries with limited walking instructions; however, customers frequently requested the ability to plan multi-modal trips, such as the ability to bike to transit. Similarly, Google Maps is capable of planning several different single-mode trips (transit or driving or walking or biking), however, it cannot plan a trip consisting of multiple modes. The ability to plan multi-modal trips, a combination of transit, walking, and biking, and to bring as much information as possible into one central location allowed commuters to make informed decisions about their transportation choices while encouraging sustainable modes and decreasing the number of drive-alone vehicle trips. Commercial off-the-shelf solutions were cost prohibitive for TriMet and many US transit agencies, and open source, multi-modal trip planners were relatively new to the market and lacked a strong user and developer base and a sustainable support model.</p>

					<p>TriMet was interested in bringing interested parties together to collaborate on an open source multi-modal trip planning system that would not only meet TriMet&rsquo;s increasing needs, but could potentially be a viable alternative for other agencies. TriMet partnered with OpenPlans, a non-profit organization that specializes in open source software and civic projects, and several other developers, on applying for a Metro Regional Travel Options (RTO) Grant in 2008 to begin work on an open source, multi-modal trip planner, which came to be known as the OpenTripPlanner. OpenPlans was responsible from the outset to lead the technical development of the project, to facilitate a strong development community around the code, and to provide a sustainable business model around the software to ensure there are maintenance and support options for agencies.</p>

                    <ul class="links">
                        <li><a href="./docs/OTP Final Report - Metro 2009-2011 RTO Grant.pdf" download="OTP Final Report - Metro 2009-2011 RTO Grant.pdf">Download the OTP Final Report for the 2009&mdash;2011 grant</a></li>
                        <li><a href="http://www.opentripplanner.org/">Visit the OTP website and view the code</a></li>
                    </ul>
                </div><!-- .col -->
            </div><!-- .row -->
        </div><!-- .contentcontainer -->
    </div><!-- .fullwidth -->
<!------- INTRO END ------->


    <div class="fullwidth">
        <div class="contentcontainer">
            <p class="top"><a href="#top">Top</a></p>
        </div>
    </div><!-- .fullwidth -->


<!------- TRIP PLANNER HISTORY BEGIN ------->
    <div class="fullwidth">
        <h2 class="section-title" id="history">TriMet Trip Planner History</h2>
		<div class="contentcontainer">
			<div class="row">
				<div class="col-xs-12">
					<div id="timeline-embed" class="timeline-class">
			<!-- 			<iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1yLV2rE0lWxU-ByS6LNGFkBhDbhNGBk58pY4499uLibg&font=Default&lang=en&initial_zoom=5&height=650' width='100%' height='650' webkitallowfullscreen mozallowfullscreen allowfullscreen frameborder='0'></iframe> -->
						<script type="text/javascript">
							timeline = new TL.Timeline('timeline-embed', 'https://docs.google.com/spreadsheets/d/1yLV2rE0lWxU-ByS6LNGFkBhDbhNGBk58pY4499uLibg/edit?usp=sharing');
						</script>
					</div>
				</div><!-- .col -->
			</div><!-- .row -->
        </div><!-- .contentcontainer -->
    </div><!-- .fullwidth -->
<!------- TRIP PLANNER HISTORY END ------->


    <div class="fullwidth">
        <div class="contentcontainer">
            <p class="top"><a href="#top">Top</a></p>
        </div>
    </div><!-- .fullwidth -->


<!------- DEPLOYMENTS BEGIN ------->
    <div class="fullwidth">
        <h2 class="section-title" id="deploy">OTP Deployments</h2>
        <div class="row">
            <div class="col-xs-12">
				<div class="map-container">
					<div id="deployments-map-navigation">
						<nav id="deployments-filters" class="filter-ui"></nav>
					</div>
					<div id="deploymenttext">
					</div>
					<div class="custom-popup" id="deployments-map">
						<script>
						L.mapbox.accessToken = 'pk.eyJ1IjoidHRsaW4xIiwiYSI6ImNpeW5hZWt3eTAwMHY0M3F6NTJtY2cwN3IifQ.OeAih8x-MUWxhRiFj98Q2Q';
						var map = L.mapbox.map('deployments-map', 'mapbox.light', {
							scrollWheelZoom: false
						})
						map.setView([23, 2], 2);

						var filters = document.getElementById('deployments-filters');
						var markers = L.mapbox.featureLayer().loadURL('./json/deployments.geojson');
						var deployments = document.getElementById('deploymenttext');

						markers.addTo(map);

						markers.on('ready', function(e) {
							var typesObj = {},
							types = [];
							var features = e.target._geojson.features;
							for (var i = 0; i < features.length; i++) {
								typesObj[features[i].properties['status']] = true;
							}
							for (var key in typesObj) {
								if ({}.hasOwnProperty.call(typesObj, key)) {
									types.push(key);
								}
							}

							var checkboxes = [];
							for (var j = 0; j < types.length; j++) {
								var item = filters.appendChild(document.createElement('div'));
								var checkbox = item.appendChild(document.createElement('input'));
								var label = item.appendChild(document.createElement('label'));
								checkbox.type = 'checkbox';
								checkbox.id = types[j];
								checkbox.checked = true;
								label.innerHTML = types[j];
								label.setAttribute('for', types[j]);
								checkbox.addEventListener('change', update);
								checkboxes.push(checkbox);
							}

							for (var i = 0; i < features.length; i++) {
								var pbox = deployments.appendChild(document.createElement('div'));
								var pboxtext = pbox.appendChild(document.createElement('p'));
								let title = features[i].properties['title'];
								let desc = features[i].properties['description'];
								let text_color = features[i].properties['marker-color'];
								let partner_status = features[i].properties['status'];
								pbox.style.cursor = 'pointer';
								pbox.id = String(features[i].geometry['coordinates']) + text_color;
								pbox.class = partner_status.replace(" ", "-");
								let longitude = parseFloat(String(features[i].geometry['coordinates']).split(",")[0]);
								let latitude = parseFloat(String(features[i].geometry['coordinates']).split(",")[1]);
								let url_path = features[i].properties['url'];
								document.getElementById(String(features[i].geometry['coordinates']) + text_color).addEventListener('click', function(){
									map.setView([latitude, longitude], 15);
									var popup = L.popup()
										.setLatLng([latitude + 0.002, longitude])
										.setContent('<p style="font-size:12px;width:100%;"><span style="font-weight:800">' + title + "</span><br>" + desc + '<br><a href="' + url_path + '" target="_blank">' + url_path + '</a></p>')
										.openOn(map);
								});
								if (url_path !== "" ) {
									pboxtext.innerHTML = '<span style="background-color:' + text_color + ';color:#fff;padding:2px">' + title + "</span><br>" + desc + '<br><a href="' + url_path + '">' + url_path + '</a>';
								} else {
									pboxtext.innerHTML = '<span style="background-color:' + text_color + ';color:#fff;padding:2px">' + title + "</span><br>" + desc.slice(0, desc.indexOf(",")) + "<br>" + desc.slice(desc.indexOf(",") + 1, desc.length);
								}
							}

							function update() {
								var enabled = {};
								for (var k = 0; k < checkboxes.length; k++) {
									if (checkboxes[k].checked) enabled[checkboxes[k].id] = true;
								}

								markers.setFilter(function(feature) {
									return feature.properties['status'] in enabled;
								});
							}
						});
					</script>
					</div>
				</div>
            </div><!-- .col -->
        </div><!-- .row -->
    </div><!-- .fullwidth -->
<!------- DEPLOYMENTS END ------->


	<div class="fullwidth">
        <div class="contentcontainer">
            <p class="top"><a href="#top">Top</a></p>
        </div>
    </div><!-- .fullwidth -->


<!-- InstanceEndEditable -->
</section><!-- #.content -->
<!--#include virtual="/asset/includes/footer.htm" -->
</div><!-- #application -->
<!-- InstanceBeginEditable name="Bottom" -->
<!-- InstanceEndEditable -->
</body>
<!-- InstanceEnd --></html>
